local UI_Module = {}
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

-- Создаем объект библиотеки
function UI_Module.CreateMain(hubTitle)
    local Library = {
        AccentColor = Color3.fromRGB(60, 100, 255),
        Tabs = {},
        TabButtons = {}
    }

    -- Создание ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "Custom_GUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

    -- Главное окно
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 620, 0, 420)
    MainFrame.Position = UDim2.new(0.5, -310, 0.5, -210)
    MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 20)
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui

    Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)
    local Stroke = Instance.new("UIStroke", MainFrame)
    Stroke.Thickness = 1.5
    Stroke.Color = Color3.fromRGB(40, 40, 45)

    -- Левый Сайдбар (ScrollingFrame)
    local SidebarScroll = Instance.new("ScrollingFrame")
    SidebarScroll.Name = "Sidebar"
    SidebarScroll.Size = UDim2.new(0, 160, 1, -60)
    SidebarScroll.Position = UDim2.new(0, 10, 0, 50)
    SidebarScroll.BackgroundTransparency = 1
    SidebarScroll.ScrollBarThickness = 0
    SidebarScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    SidebarScroll.Parent = MainFrame

    local SideLayout = Instance.new("UIListLayout", SidebarScroll)
    SideLayout.Padding = UDim.new(0, 6)
    SideLayout.SortOrder = Enum.SortOrder.LayoutOrder
    SideLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        SidebarScroll.CanvasSize = UDim2.new(0, 0, 0, SideLayout.AbsoluteContentSize.Y)
    end)

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(0, 160, 0, 50)
    TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    TitleLabel.Text = hubTitle
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 18
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Parent = MainFrame

    -- Контейнер для страниц
    local PagesFolder = Instance.new("Frame")
    PagesFolder.Name = "PagesContainer"
    PagesFolder.Size = UDim2.new(1, -190, 1, -20)
    PagesFolder.Position = UDim2.new(0, 180, 0, 10)
    PagesFolder.BackgroundTransparency = 1
    PagesFolder.Parent = MainFrame

    local ActiveTab = nil

    -- Функция обновления темы
    local function RefreshTheme()
        for _, btn in pairs(Library.TabButtons) do
            if btn:GetAttribute("Active") then
                TweenService:Create(btn, TweenInfo.new(0.3), {BackgroundColor3 = Library.AccentColor}):Play()
            end
        end
    end

    -- МЕТОД СОЗДАНИЯ ВКЛАДКИ (Теперь точно работает!)
    function Library:CreateTab(name, isSettings)
        local TabData = {}
        
        -- Кнопка
        local TabBtn = Instance.new("TextButton")
        TabBtn.Size = UDim2.new(1, -5, 0, 35)
        TabBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
        TabBtn.Text = name
        TabBtn.TextColor3 = Color3.fromRGB(180, 180, 185)
        TabBtn.Font = Enum.Font.GothamMedium
        TabBtn.TextSize = 13
        TabBtn.LayoutOrder = isSettings and 9999 or #Library.TabButtons
        TabBtn.Parent = SidebarScroll
        Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0, 6)
        
        table.insert(Library.TabButtons, TabBtn)

        -- Страница
        local Page = Instance.new("ScrollingFrame")
        Page.Name = name .. "_Page"
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.BackgroundTransparency = 1
        Page.Visible = false
        Page.ScrollBarThickness = 2
        Page.ScrollBarImageColor3 = Color3.fromRGB(60, 60, 65)
        Page.Parent = PagesFolder

        local PageLayout = Instance.new("UIListLayout", Page)
        PageLayout.Padding = UDim.new(0, 10)
        PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
        PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 20)
        end)

        -- Заголовок страницы
        local Header = Instance.new("TextLabel")
        Header.Size = UDim2.new(1, 0, 0, 40)
        Header.Text = name
        Header.TextColor3 = Color3.fromRGB(255, 255, 255)
        Header.Font = Enum.Font.GothamBold
        Header.TextSize = 24
        Header.TextXAlignment = Enum.TextXAlignment.Left
        Header.BackgroundTransparency = 1
        Header.Parent = Page

        -- Логика переключения
        TabBtn.MouseButton1Click:Connect(function()
            for _, p in pairs(PagesFolder:GetChildren()) do p.Visible = false end
            for _, b in pairs(Library.TabButtons) do
                b:SetAttribute("Active", false)
                TweenService:Create(b, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(25, 25, 28), TextColor3 = Color3.fromRGB(180, 180, 185)}):Play()
            end
            Page.Visible = true
            TabBtn:SetAttribute("Active", true)
            TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundColor3 = Library.AccentColor, TextColor3 = Color3.fromRGB(255, 255, 255)}):Play()
        end)

        -- Открытие первой вкладки
        if not ActiveTab and not isSettings then
            ActiveTab = Page
            Page.Visible = true
            TabBtn:SetAttribute("Active", true)
            TabBtn.BackgroundColor3 = Library.AccentColor
            TabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        end

        --- ЭЛЕМЕНТЫ СТРАНИЦЫ ---

        -- 1. Текст с кнопкой справа
        function TabData:AddButtonRow(text, btnText, callback)
            local Row = Instance.new("Frame")
            Row.Size = UDim2.new(1, -10, 0, 45)
            Row.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
            Row.Parent = Page
            Instance.new("UICorner", Row)
            Instance.new("UIStroke", Row).Color = Color3.fromRGB(40,40,45)

            local L = Instance.new("TextLabel")
            L.Size = UDim2.new(0.6, 0, 1, 0)
            L.Position = UDim2.new(0, 15, 0, 0)
            L.Text = text
            L.TextColor3 = Color3.fromRGB(200, 200, 205)
            L.Font = Enum.Font.Gotham
            L.TextXAlignment = Enum.TextXAlignment.Left
            L.BackgroundTransparency = 1
            L.Parent = Row

            local B = Instance.new("TextButton")
            B.Size = UDim2.new(0.3, 0, 0, 30)
            B.Position = UDim2.new(0.65, 0, 0.5, -15)
            B.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
            B.Text = btnText
            B.TextColor3 = Color3.new(1,1,1)
            B.Font = Enum.Font.GothamBold
            B.Parent = Row
            Instance.new("UICorner", B).CornerRadius = UDim.new(0, 6)
            B.MouseButton1Click:Connect(callback)
        end

        -- 2. Текст с кнопкой + ScrollingFrame
        function TabData:AddComplexRow(text, btnText, height, callback)
            local Container = Instance.new("Frame")
            Container.Size = UDim2.new(1, -10, 0, 50 + height)
            Container.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
            Container.Parent = Page
            Instance.new("UICorner", Container)

            local L = Instance.new("TextLabel")
            L.Size = UDim2.new(0.6, 0, 0, 45)
            L.Position = UDim2.new(0, 15, 0, 0)
            L.Text = text
            L.TextColor3 = Color3.fromRGB(200, 200, 205)
            L.Font = Enum.Font.Gotham
            L.TextXAlignment = Enum.TextXAlignment.Left
            L.BackgroundTransparency = 1
            L.Parent = Container

            local B = Instance.new("TextButton")
            B.Size = UDim2.new(0.3, 0, 0, 30)
            B.Position = UDim2.new(0.65, 0, 0, 7)
            B.BackgroundColor3 = Library.AccentColor
            B.Text = btnText
            B.Parent = Container
            Instance.new("UICorner", B)

            local S = Instance.new("ScrollingFrame")
            S.Size = UDim2.new(1, -20, 0, height)
            S.Position = UDim2.new(0, 10, 0, 45)
            S.BackgroundColor3 = Color3.fromRGB(15, 15, 17)
            S.ScrollBarThickness = 2
            S.Parent = Container
            Instance.new("UICorner", S)
            Instance.new("UIListLayout", S).Padding = UDim.new(0, 2)

            B.MouseButton1Click:Connect(function() callback(S) end)
        end

        -- 3. Обычный текст
        function TabData:AddLabel(text)
            local L = Instance.new("TextLabel")
            L.Size = UDim2.new(1, -10, 0, 25)
            L.BackgroundTransparency = 1
            L.Text = text
            L.TextColor3 = Color3.fromRGB(150, 150, 155)
            L.Font = Enum.Font.Gotham
            L.TextSize = 14
            L.TextXAlignment = Enum.TextXAlignment.Left
            L.Parent = Page
        end

        return TabData
    end

    -- Вшиваем Settings в самый конец
    local Settings = Library:CreateTab("Settings", true)
    Settings:AddLabel("Управление темой:")
    
    local themes = {
        ["Electric Blue"] = Color3.fromRGB(60, 100, 255),
        ["Ruby Red"] = Color3.fromRGB(255, 60, 60),
        ["Emerald Green"] = Color3.fromRGB(60, 255, 120),
        ["Vivid Purple"] = Color3.fromRGB(180, 60, 255),
        ["Sunset Orange"] = Color3.fromRGB(255, 140, 0)
    }

    for name, color in pairs(themes) do
        Settings:AddButtonRow(name, "Set", function()
            Library.AccentColor = color
            RefreshTheme()
        end)
    end

    return Library
end

return UI_Module
