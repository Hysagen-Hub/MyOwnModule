local UI_Module = {}
local TweenService = game:GetService("TweenService")

function UI_Module.CreateMain(hubTitle)
	local Library = {
		AccentColor = Color3.fromRGB(60, 90, 255),
		TabButtons = {}
	}
	
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "Gemini_V3"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")

	local Main = Instance.new("Frame")
	Main.Name = "MainFrame"
	Main.Size = UDim2.new(0, 620, 0, 420)
	Main.Position = UDim2.new(0.5, -310, 0.5, -210)
	Main.BackgroundColor3 = Color3.fromRGB(15, 15, 17)
	Main.BorderSizePixel = 0
	Main.Parent = ScreenGui

	Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 12)
	local MainStroke = Instance.new("UIStroke", Main)
	MainStroke.Thickness = 1.8
	MainStroke.Color = Color3.fromRGB(40, 40, 45)

	-- Левая панель (Сайдбар)
	local SidebarContainer = Instance.new("Frame")
	SidebarContainer.Size = UDim2.new(0, 165, 1, 0)
	SidebarContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 23)
	SidebarContainer.BorderSizePixel = 0
	SidebarContainer.Parent = Main
	Instance.new("UICorner", SidebarContainer).CornerRadius = UDim.new(0, 12)

	local SidebarScroll = Instance.new("ScrollingFrame")
	SidebarScroll.Size = UDim2.new(1, -10, 1, -70)
	SidebarScroll.Position = UDim2.new(0, 5, 0, 60)
	SidebarScroll.BackgroundTransparency = 1
	SidebarScroll.ScrollBarThickness = 0
	SidebarScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
	SidebarScroll.Parent = SidebarContainer

	local SideLayout = Instance.new("UIListLayout", SidebarScroll)
	SideLayout.Padding = UDim.new(0, 5)
	SideLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	SideLayout.SortOrder = Enum.SortOrder.LayoutOrder

	SideLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		SidebarScroll.CanvasSize = UDim2.new(0, 0, 0, SideLayout.AbsoluteContentSize.Y)
	end)

	local HubTitleLabel = Instance.new("TextLabel")
	HubTitleLabel.Size = UDim2.new(1, 0, 0, 60)
	HubTitleLabel.Text = hubTitle
	HubTitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	HubTitleLabel.Font = Enum.Font.GothamBold
	HubTitleLabel.TextSize = 18
	HubTitleLabel.BackgroundTransparency = 1
	HubTitleLabel.Parent = SidebarContainer

	-- Правая панель
	local PagesFolder = Instance.new("Frame")
	PagesFolder.Size = UDim2.new(1, -185, 1, -20)
	PagesFolder.Position = UDim2.new(0, 175, 0, 10)
	PagesFolder.BackgroundTransparency = 1
	PagesFolder.Parent = Main

	local ActivePage = nil

	-- Функция обновления темы
	local function UpdateTheme()
		for _, btn in pairs(Library.TabButtons) do
			if btn:GetAttribute("Active") then
				TweenService:Create(btn, TweenInfo.new(0.3), {BackgroundColor3 = Library.AccentColor}):Play()
			end
		end
	end

	-- ОСНОВНОЙ МЕТОД СОЗДАНИЯ ВКЛАДКИ
	function Library:CreateTab(name, isSettings)
		local TabElements = {}
		
		local TabBtn = Instance.new("TextButton")
		TabBtn.Size = UDim2.new(0.9, 0, 0, 38)
		TabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
		TabBtn.Text = name
		TabBtn.TextColor3 = Color3.fromRGB(160, 160, 165)
		TabBtn.Font = Enum.Font.GothamMedium
		TabBtn.TextSize = 13
		TabBtn.Parent = SidebarScroll
		TabBtn.LayoutOrder = isSettings and 9999 or #Library.TabButtons
		Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0, 8)
		
		table.insert(Library.TabButtons, TabBtn)

		local PageScroll = Instance.new("ScrollingFrame")
		PageScroll.Name = name .. "_Page"
		PageScroll.Size = UDim2.new(1, 0, 1, 0)
		PageScroll.BackgroundTransparency = 1
		PageScroll.Visible = false
		PageScroll.ScrollBarThickness = 2
		PageScroll.ScrollBarImageColor3 = Color3.fromRGB(60, 60, 65)
		PageScroll.Parent = PagesFolder

		local PageLayout = Instance.new("UIListLayout", PageScroll)
		PageLayout.Padding = UDim.new(0, 10)
		PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
		PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			PageScroll.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 10)
		end)

		-- Авто-заголовок
		local Title = Instance.new("TextLabel")
		Title.Size = UDim2.new(1, 0, 0, 40)
		Title.Text = name
		Title.TextColor3 = Color3.fromRGB(255, 255, 255)
		Title.Font = Enum.Font.GothamBold
		Title.TextSize = 24
		Title.TextXAlignment = Enum.TextXAlignment.Left
		Title.BackgroundTransparency = 1
		Title.Parent = PageScroll

		TabBtn.MouseButton1Click:Connect(function()
			for _, p in pairs(PagesFolder:GetChildren()) do p.Visible = false end
			for _, b in pairs(Library.TabButtons) do
				b:SetAttribute("Active", false)
				TweenService:Create(b, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(30, 30, 35), TextColor3 = Color3.fromRGB(160, 160, 165)}):Play()
			end
			PageScroll.Visible = true
			TabBtn:SetAttribute("Active", true)
			TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundColor3 = Library.AccentColor, TextColor3 = Color3.fromRGB(255, 255, 255)}):Play()
		end)

		-- Авто-открытие первой вкладки
		if not ActivePage and not isSettings then
			ActivePage = PageScroll
			PageScroll.Visible = true
			TabBtn:SetAttribute("Active", true)
			TabBtn.BackgroundColor3 = Library.AccentColor
			TabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
		end

		--- МЕТОДЫ ЭЛЕМЕНТОВ ---
		function TabElements:AddButtonRow(text, btnText, callback)
			local Row = Instance.new("Frame")
			Row.Size = UDim2.new(1, -10, 0, 45)
			Row.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
			Row.Parent = PageScroll
			Instance.new("UICorner", Row)
			Instance.new("UIStroke", Row).Color = Color3.fromRGB(40,40,45)

			local L = Instance.new("TextLabel")
			L.Size = UDim2.new(0.6, 0, 1, 0)
			L.Position = UDim2.new(0, 15, 0, 0)
			L.Text = text
			L.TextColor3 = Color3.fromRGB(200, 200, 205)
			L.Font = Enum.Font.Gotham
			L.TextXAlignment = Enum.TextXAlignment.Left
			L.BackgroundTransparency = 1
			L.Parent = Row

			local B = Instance.new("TextButton")
			B.Size = UDim2.new(0.3, 0, 0, 30)
			B.Position = UDim2.new(0.65, 0, 0.5, -15)
			B.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
			B.Text = btnText
			B.TextColor3 = Color3.new(1, 1, 1)
			B.Font = Enum.Font.GothamBold
			B.Parent = Row
			Instance.new("UICorner", B).CornerRadius = UDim.new(0, 6)
			B.MouseButton1Click:Connect(callback)
		end

		function TabElements:AddComplexRow(text, btnText, height, callback)
			local Container = Instance.new("Frame")
			Container.Size = UDim2.new(1, -10, 0, 55 + height)
			Container.BackgroundColor3 = Color3.fromRGB(25, 25, 28)
			Container.Parent = PageScroll
			Instance.new("UICorner", Container)

			local L = Instance.new("TextLabel")
			L.Size = UDim2.new(0.6, 0, 0, 45)
			L.Position = UDim2.new(0, 15, 0, 0)
			L.Text = text
			L.TextColor3 = Color3.fromRGB(200, 200, 205)
			L.Font = Enum.Font.Gotham
			L.TextXAlignment = Enum.TextXAlignment.Left
			L.BackgroundTransparency = 1
			L.Parent = Container

			local B = Instance.new("TextButton")
			B.Size = UDim2.new(0.3, 0, 0, 30)
			B.Position = UDim2.new(0.65, 0, 0, 7)
			B.BackgroundColor3 = Color3.fromRGB(50, 150, 80)
			B.Text = btnText
			B.Parent = Container
			Instance.new("UICorner", B)

			local S = Instance.new("ScrollingFrame")
			S.Size = UDim2.new(1, -20, 0, height)
			S.Position = UDim2.new(0, 10, 0, 45)
			S.BackgroundColor3 = Color3.fromRGB(15, 15, 17)
			S.ScrollBarThickness = 2
			S.Parent = Container
			Instance.new("UICorner", S)
			Instance.new("UIListLayout", S).Padding = UDim.new(0, 2)

			B.MouseButton1Click:Connect(function() callback(S) end)
		end

		function TabElements:AddLabel(text)
			local L = Instance.new("TextLabel")
			L.Size = UDim2.new(1, -10, 0, 25)
			L.BackgroundTransparency = 1
			L.Text = text
			L.TextColor3 = Color3.fromRGB(150, 150, 155)
			L.Font = Enum.Font.Gotham
			L.TextSize = 14
			L.TextXAlignment = Enum.TextXAlignment.Left
			L.Parent = PageScroll
		end

		return TabElements
	end

	-- Создаем вкладку Settings автоматически
	local SettingsTab = Library:CreateTab("Settings", true)
	SettingsTab:AddLabel("Выберите основной цвет интерфейса:")
	
	local colors = {
		["Синий"] = Color3.fromRGB(60, 90, 255),
		["Красный"] = Color3.fromRGB(255, 60, 60),
		["Зеленый"] = Color3.fromRGB(60, 255, 120),
		["Золотой"] = Color3.fromRGB(255, 200, 60),
		["Розовый"] = Color3.fromRGB(255, 105, 180)
	}

	for name, color in pairs(colors) do
		SettingsTab:AddButtonRow("Тема: "..name, "Применить", function()
			Library.AccentColor = color
			UpdateTheme()
		end)
	end

	return Library
end

return UI_Module
