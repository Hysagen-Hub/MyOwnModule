local GuiCreator = {}

-- Настройки внешнего вида
local THEME = {
    Background = Color3.fromRGB(30, 30, 30),
    SecondaryBg = Color3.fromRGB(40, 40, 40),
    Accent = Color3.fromRGB(0, 160, 255),
    Text = Color3.fromRGB(255, 255, 255),
    Hover = Color3.fromRGB(60, 60, 60),
    TabInactive = Color3.fromRGB(50, 50, 50),
    TabActive = Color3.fromRGB(70, 70, 70),
    ButtonBg = Color3.fromRGB(0, 120, 210),
    ButtonHover = Color3.fromRGB(0, 140, 255)
}

-- Функция для создания основного GUI
function GuiCreator:CreateMainGUI(parent)
    -- Создаем основной Frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainGUI"
    mainFrame.Size = UDim2.new(0, 800, 0, 500)
    mainFrame.Position = UDim2.new(0.5, -400, 0.5, -250)
    mainFrame.BackgroundColor3 = THEME.Background
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = parent or game:GetService("Players").LocalPlayer.PlayerGui
    
    -- Делаем красивые скругленные углы
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = mainFrame
    
    -- Добавляем тень
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "Shadow"
    shadow.Size = UDim2.new(1, 20, 1, 20)
    shadow.Position = UDim2.new(0, -10, 0, -10)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = Color3.new(0, 0, 0)
    shadow.ImageTransparency = 0.5
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 10, 10)
    shadow.Parent = mainFrame
    
    -- Левая панель с вкладками
    local leftPanel = Instance.new("Frame")
    leftPanel.Name = "LeftPanel"
    leftPanel.Size = UDim2.new(0, 200, 1, -20)
    leftPanel.Position = UDim2.new(0, 10, 0, 10)
    leftPanel.BackgroundColor3 = THEME.SecondaryBg
    leftPanel.BorderSizePixel = 0
    leftPanel.Parent = mainFrame
    
    local leftCorner = Instance.new("UICorner")
    leftCorner.CornerRadius = UDim.new(0, 6)
    leftCorner.Parent = leftPanel
    
    -- Заголовок левой панели
    local leftTitle = Instance.new("TextLabel")
    leftTitle.Name = "Title"
    leftTitle.Size = UDim2.new(1, -20, 0, 30)
    leftTitle.Position = UDim2.new(0, 10, 0, 10)
    leftTitle.BackgroundTransparency = 1
    leftTitle.Text = "ВКЛАДКИ"
    leftTitle.TextColor3 = THEME.Text
    leftTitle.TextScaled = true
    leftTitle.Font = Enum.Font.GothamBold
    leftTitle.TextXAlignment = Enum.TextXAlignment.Left
    leftTitle.Parent = leftPanel
    
    -- ScrollingFrame для вкладок
    local tabsScrolling = Instance.new("ScrollingFrame")
    tabsScrolling.Name = "TabsScrollingFrame"
    tabsScrolling.Size = UDim2.new(1, -20, 1, -50)
    tabsScrolling.Position = UDim2.new(0, 10, 0, 45)
    tabsScrolling.BackgroundTransparency = 1
    tabsScrolling.BorderSizePixel = 0
    tabsScrolling.ScrollBarThickness = 4
    tabsScrolling.ScrollBarImageColor3 = THEME.Accent
    tabsScrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
    tabsScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
    tabsScrolling.Parent = leftPanel
    
    -- UIListLayout для вкладок
    local tabsLayout = Instance.new("UIListLayout")
    tabsLayout.Padding = UDim.new(0, 5)
    tabsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabsLayout.Parent = tabsScrolling
    
    -- Правая панель с функциями
    local rightPanel = Instance.new("Frame")
    rightPanel.Name = "RightPanel"
    rightPanel.Size = UDim2.new(1, -220, 1, -20)
    rightPanel.Position = UDim2.new(0, 220, 0, 10)
    rightPanel.BackgroundColor3 = THEME.SecondaryBg
    rightPanel.BorderSizePixel = 0
    rightPanel.Parent = mainFrame
    
    local rightCorner = Instance.new("UICorner")
    rightCorner.CornerRadius = UDim.new(0, 6)
    rightCorner.Parent = rightPanel
    
    -- Заголовок правой панели (будет обновляться)
    local rightTitle = Instance.new("TextLabel")
    rightTitle.Name = "Title"
    rightTitle.Size = UDim2.new(1, -20, 0, 30)
    rightTitle.Position = UDim2.new(0, 10, 0, 10)
    rightTitle.BackgroundTransparency = 1
    rightTitle.Text = "ФУНКЦИИ"
    rightTitle.TextColor3 = THEME.Text
    rightTitle.TextScaled = true
    rightTitle.Font = Enum.Font.GothamBold
    rightTitle.TextXAlignment = Enum.TextXAlignment.Left
    rightTitle.Parent = rightPanel
    
    -- ScrollingFrame для функций
    local functionsScrolling = Instance.new("ScrollingFrame")
    functionsScrolling.Name = "FunctionsScrollingFrame"
    functionsScrolling.Size = UDim2.new(1, -20, 1, -50)
    functionsScrolling.Position = UDim2.new(0, 10, 0, 45)
    functionsScrolling.BackgroundTransparency = 1
    functionsScrolling.BorderSizePixel = 0
    functionsScrolling.ScrollBarThickness = 4
    functionsScrolling.ScrollBarImageColor3 = THEME.Accent
    functionsScrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
    functionsScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
    functionsScrolling.Parent = rightPanel
    
    -- UIListLayout для функций
    local functionsLayout = Instance.new("UIListLayout")
    functionsLayout.Padding = UDim.new(0, 8)
    functionsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    functionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    functionsLayout.Parent = functionsScrolling
    
    -- Сохраняем ссылки
    mainFrame.TabsScrolling = tabsScrolling
    mainFrame.FunctionsScrolling = functionsScrolling
    mainFrame.TabsLayout = tabsLayout
    mainFrame.FunctionsLayout = functionsLayout
    mainFrame.RightTitle = rightTitle
    mainFrame.Tabs = {}
    mainFrame.CurrentTab = nil
    
    return mainFrame
end

-- Функция создания вкладки
function GuiCreator:CreateTab(mainFrame, tabName)
    local tabFrame = Instance.new("Frame")
    tabFrame.Name = tabName .. "Tab"
    tabFrame.Size = UDim2.new(1, -10, 0, 40)
    tabFrame.BackgroundColor3 = THEME.TabInactive
    tabFrame.BorderSizePixel = 0
    tabFrame.Parent = mainFrame.TabsScrolling
    
    -- Скругление
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 6)
    tabCorner.Parent = tabFrame
    
    -- Название вкладки
    local tabLabel = Instance.new("TextLabel")
    tabLabel.Name = "TabName"
    tabLabel.Size = UDim2.new(1, -10, 1, 0)
    tabLabel.Position = UDim2.new(0, 5, 0, 0)
    tabLabel.BackgroundTransparency = 1
    tabLabel.Text = tabName
    tabLabel.TextColor3 = THEME.Text
    tabLabel.TextScaled = true
    tabLabel.Font = Enum.Font.Gotham
    tabLabel.TextXAlignment = Enum.TextXAlignment.Left
    tabLabel.Parent = tabFrame
    
    -- Индикатор активности
    local activeIndicator = Instance.new("Frame")
    activeIndicator.Name = "ActiveIndicator"
    activeIndicator.Size = UDim2.new(0, 4, 1, -10)
    activeIndicator.Position = UDim2.new(1, -9, 0, 5)
    activeIndicator.BackgroundColor3 = THEME.Accent
    activeIndicator.BorderSizePixel = 0
    activeIndicator.Visible = false
    activeIndicator.Parent = tabFrame
    
    local indicatorCorner = Instance.new("UICorner")
    indicatorCorner.CornerRadius = UDim.new(1, 0)
    indicatorCorner.Parent = activeIndicator
    
    -- Кнопка для выбора вкладки
    local tabButton = Instance.new("TextButton")
    tabButton.Name = "TabButton"
    tabButton.Size = UDim2.new(1, 0, 1, 0)
    tabButton.BackgroundTransparency = 1
    tabButton.Text = ""
    tabButton.Parent = tabFrame
    
    -- Эффекты наведения
    tabButton.MouseEnter:Connect(function()
        if mainFrame.CurrentTab ~= tabFrame then
            tabFrame.BackgroundColor3 = THEME.Hover
        end
    end)
    
    tabButton.MouseLeave:Connect(function()
        if mainFrame.CurrentTab ~= tabFrame then
            tabFrame.BackgroundColor3 = THEME.TabInactive
        end
    end)
    
    -- Выбор вкладки
    tabButton.MouseButton1Click:Connect(function()
        self:SelectTab(mainFrame, tabFrame)
    end)
    
    -- Сохраняем вкладку
    table.insert(mainFrame.Tabs, tabFrame)
    tabFrame.ActiveIndicator = activeIndicator
    
    -- Если это первая вкладка, выбираем её
    if #mainFrame.Tabs == 1 then
        self:SelectTab(mainFrame, tabFrame)
    end
    
    return tabFrame
end

-- Функция выбора вкладки
function GuiCreator:SelectTab(mainFrame, tabFrame)
    -- Деактивируем все вкладки
    for _, tab in pairs(mainFrame.Tabs) do
        tab.BackgroundColor3 = THEME.TabInactive
        if tab.ActiveIndicator then
            tab.ActiveIndicator.Visible = false
        end
    end
    
    -- Активируем выбранную вкладку
    tabFrame.BackgroundColor3 = THEME.TabActive
    if tabFrame.ActiveIndicator then
        tabFrame.ActiveIndicator.Visible = true
    end
    
    mainFrame.CurrentTab = tabFrame
    
    -- Очищаем функции
    self:ClearFunctions(mainFrame)
    
    -- Обновляем заголовок
    local tabLabel = tabFrame:FindFirstChild("TabName")
    if tabLabel then
        mainFrame.RightTitle.Text = tabLabel.Text:upper() .. " - ФУНКЦИИ"
    end
end

-- Функция создания функции (TextLabel + кнопка)
function GuiCreator:CreateFunction(mainFrame, functionName, callback)
    if not mainFrame.CurrentTab then
        warn("Сначала выберите вкладку!")
        return nil
    end
    
    local functionFrame = Instance.new("Frame")
    functionFrame.Name = functionName .. "Function"
    functionFrame.Size = UDim2.new(1, -10, 0, 45)
    functionFrame.BackgroundColor3 = THEME.Background
    functionFrame.BorderSizePixel = 0
    functionFrame.Parent = mainFrame.FunctionsScrolling
    
    -- Скругление
    local funcCorner = Instance.new("UICorner")
    funcCorner.CornerRadius = UDim.new(0, 6)
    funcCorner.Parent = functionFrame
    
    -- Название функции
    local funcLabel = Instance.new("TextLabel")
    funcLabel.Name = "FunctionName"
    funcLabel.Size = UDim2.new(0.7, -15, 1, 0)
    funcLabel.Position = UDim2.new(0, 10, 0, 0)
    funcLabel.BackgroundTransparency = 1
    funcLabel.Text = functionName
    funcLabel.TextColor3 = THEME.Text
    funcLabel.TextScaled = true
    funcLabel.Font = Enum.Font.Gotham
    funcLabel.TextXAlignment = Enum.TextXAlignment.Left
    funcLabel.Parent = functionFrame
    
    -- Кнопка
    local actionButton = Instance.new("TextButton")
    actionButton.Name = "ActionButton"
    actionButton.Size = UDim2.new(0.25, -15, 1, -10)
    actionButton.Position = UDim2.new(0.75, 5, 0, 5)
    actionButton.BackgroundColor3 = THEME.ButtonBg
    actionButton.Text = "▶ ВЫПОЛНИТЬ"
    actionButton.TextColor3 = THEME.Text
    actionButton.TextScaled = true
    actionButton.Font = Enum.Font.GothamBold
    actionButton.BorderSizePixel = 0
    actionButton.Parent = functionFrame
    
    -- Скругление кнопки
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 4)
    buttonCorner.Parent = actionButton
    
    -- Эффекты наведения на кнопку
    actionButton.MouseEnter:Connect(function()
        actionButton.BackgroundColor3 = THEME.ButtonHover
    end)
    
    actionButton.MouseLeave:Connect(function()
        actionButton.BackgroundColor3 = THEME.ButtonBg
    end)
    
    -- Обработчик нажатия
    if callback then
        actionButton.MouseButton1Click:Connect(function()
            callback()
        end)
    end
    
    return functionFrame
end

-- Функция очистки функций текущей вкладки
function GuiCreator:ClearFunctions(mainFrame)
    for _, child in pairs(mainFrame.FunctionsScrolling:GetChildren()) do
        if child:IsA("Frame") and child.Name ~= "UIListLayout" then
            child:Destroy()
        end
    end
end

-- Функция создания разделителя
function GuiCreator:CreateSeparator(mainFrame)
    local separator = Instance.new("Frame")
    separator.Name = "Separator"
    separator.Size = UDim2.new(1, -20, 0, 1)
    separator.BackgroundColor3 = THEME.Text
    separator.BackgroundTransparency = 0.8
    separator.BorderSizePixel = 0
    separator.Parent = mainFrame.FunctionsScrolling
    
    return separator
end

return GuiCreator
